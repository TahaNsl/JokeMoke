@page "/createjoke"
@page "/createjoke/{id:int}"
@inject IJokerService JokeService
@inject IUserService userService
@inject NavigationManager NavigationManager

<style>
    body {
        background-color: #8EC5FC;
        background-image: linear-gradient(62deg, #8EC5FC 0%, #E0C3FC 100%);
    }
</style>

<PageTitle>جک جدید بسازید</PageTitle>
    <h3>جک جدید بسازید</h3>

<EditForm Model="joke" OnSubmit="HandleSubmit">
    <div>
        <lable for="Value">جوکتو بساز!</lable>
        <InputText id="value" @bind-Value="joke.Value" class="form-control"></InputText>
    </div>
    <div>
        <label>نوع جوک</label><br />
        <InputSelect @bind-Value="joke.JokeTypeId" class="form-select">
            @foreach (var JokeType in JokeService.JokeTypes)
           {
               <option value="@JokeType.Id">@JokeType.Name</option>
           }
        </InputSelect>
    </div>
    <br />
    <button type="submit" class="btn btn-success">@btnText</button>
    @*<button type="button" class="btn btn-danger" @onclick="DeleteUser">Delete User</button>*@
</EditForm>

@code {
    [Parameter]
    public int? Id { get; set; }

    string btnText = string.Empty;

    Joke joke = new Joke { JokeType = new JokeType() };

    protected override async  Task OnInitializedAsync()
    {
        btnText = "Create Joke";
        await JokeService.GetJokeTypes();
    }

    protected override async Task OnParametersSetAsync()
    {
            joke.JokeType = JokeService.JokeTypes[0];
            joke.JokeTypeId = joke.JokeType.Id;
    }

    async Task HandleSubmit()
    {
            User currentUser = await _httpClient.GetFromJsonAsync<User>("user/getcurrentuser");
            await JokeService.CreateJoke(joke);
    }

    //async Task DeleteUser()
    //{
    //    await UserService.DeleteUser(user.Id);
    //}

}
